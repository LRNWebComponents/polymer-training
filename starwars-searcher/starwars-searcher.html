<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-input/paper-input.html">

<!--
`starwars-searcher`


@demo demo/index.html
-->

<dom-module id="starwars-searcher">
  <template>
    <style>
      :host {
        display: block;
      }
      #cards {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
      }
      paper-card {
        max-width: 400px;
        margin-bottom: 1em;
        width: 100%;
      }
    </style>

    <h1>Star Wars Characters</h1>

    <iron-ajax
       auto
       id="get_people"
       url="[[url]]"
       handle-as="json"
       on-response="_getPeopleHandler"></iron-ajax>

    <paper-input label="Search for Character" value="{{search}}"></paper-input>

    <div id="cards">
      <template is="dom-repeat" is="dom-repeat" items="[[people]]" as="person">
          <paper-card heading="[[person.name]]">
            <div class="card-content">
              <h3>Stats</h3>
              <ul>
                <li>Mass: [[person.mass]]</li>
                <li>Birth Year: [[person.birth_year]]</li>
                <li>Eye Color: [[person.eye_color]]</li>
                <li>Hair Color: [[person.hair_color]]</li>
              </ul>
            </div>
          </paper-card>
      </template>
    </div>

  </template>

  <script>
    Polymer({

      is: 'starwars-searcher',

      properties: {
        people: {
          type: Array,
          value: [],
        },
        search: {
          type: String,
          value: '',
          observer: '_searchChanged'
        },
        url: {
          type: String,
          value: 'https://swapi.co/api/people/'
        }
      },
      _getPeopleHandler: function (e) {
        const response = e.detail.response;
        const people = response.results;
        this.set('people', []);
        this.set('people', people);
        console.log(people);
      },
      _searchChanged: function (search, oldSearch) {
        if (search) {
          this.url = `https://swapi.co/api/people/?search=${search}`;
        }
        else {
          this.url = 'https://swapi.co/api/people/';
        }
      }
    });
  </script>
</dom-module>
